## Copyright (C) 2022-2024 Pablo Alvarado
## EL5857 Aprendizaje automático
## Tarea 2

## Cómo usar la prueba unitaria:
##
## 1) Inicie GNU/Octave en el directorio que contiene su función lowess.m
## 2) Agregue la ruta de las pruebas unitarias (p.ej. addpath("../tests"))
## 3) Ejecute el script de prueba test_lowess

printf("Prueba regresión ponderada localmente: ")

success=0;
failed=0;

## Ground truth parameters
theta_gt=[0.48;0.2;-1.86];

## Genere N datos para estimar los parámetros
N=10;

X_gt = [
       -1                      -1
       -1                   -0.75
       -1                    -0.5
       -1                   -0.25
       -1                       0
       -1                    0.25
       -1                     0.5
       -1                    0.75
       -1                       1
    -0.75                      -1
    -0.75                   -0.75
    -0.75                    -0.5
    -0.75                   -0.25
    -0.75                       0
    -0.75                    0.25
    -0.75                     0.5
    -0.75                    0.75
    -0.75                       1
     -0.5                      -1
     -0.5                   -0.75
     -0.5                    -0.5
     -0.5                   -0.25
     -0.5                       0
     -0.5                    0.25
     -0.5                     0.5
     -0.5                    0.75
     -0.5                       1
    -0.25                      -1
    -0.25                   -0.75
    -0.25                    -0.5
    -0.25                   -0.25
    -0.25                       0
    -0.25                    0.25
    -0.25                     0.5
    -0.25                    0.75
    -0.25                       1
        0                      -1
        0                   -0.75
        0                    -0.5
        0                   -0.25
        0                       0
        0                    0.25
        0                     0.5
        0                    0.75
        0                       1
     0.25                      -1
     0.25                   -0.75
     0.25                    -0.5
     0.25                   -0.25
     0.25                       0
     0.25                    0.25
     0.25                     0.5
     0.25                    0.75
     0.25                       1
      0.5                      -1
      0.5                   -0.75
      0.5                    -0.5
      0.5                   -0.25
      0.5                       0
      0.5                    0.25
      0.5                     0.5
      0.5                    0.75
      0.5                       1
     0.75                      -1
     0.75                   -0.75
     0.75                    -0.5
     0.75                   -0.25
     0.75                       0
     0.75                    0.25
     0.75                     0.5
     0.75                    0.75
     0.75                       1
        1                      -1
        1                   -0.75
        1                    -0.5
        1                   -0.25
        1                       0
        1                    0.25
        1                     0.5
        1                    0.75
        1                       1];


z_gt = [
       1.855891715407798       2.453687954361672       2.224729518961638      0.9965175649830584     -0.7239061727932943      -2.015148710126446      -2.222245918027207        -1.4251339498655     -0.2729165488062538
       1.782852678227943       3.086229479588942       3.626519730364973       2.942282397544218       1.396247374400339   -0.004794042619163552     -0.4134028408790806      0.2037118579066008       1.175994804477863
      0.7968861773981492         2.4879475013711       3.550731570401041       3.304395479064939       1.997525505551004      0.7000634465332383      0.3896281623444692        1.13882791974368       2.197750881226378
     -0.5659019721002491       1.228109738486088        2.56137387561865       2.625357646458923       1.584977600975573      0.5256399914799741      0.4755652364664296       1.496241539486679       2.755615794114044
       -1.65234546386552      0.0635698771090224        1.47960692201463       1.752952284803059      0.9810118431238463      0.1903906922478129       0.374445718559039       1.572808982366708       2.936930316408627
      -2.149148158907353     -0.6468900846425025      0.6822761093884437        1.05657944542442      0.5228111996191731    -0.02808894961013925      0.2794782559989525        1.46821720818276       2.762365613500314
      -1.996815392905849     -0.7598865799100041      0.3898050203724787      0.7963323381746428      0.4640713194420103     0.08980696739138816      0.3753755788483141       1.344227618134522       2.376816379263997
      -1.162929653098879    -0.04581526689997265       1.040049301957475       1.551933463548701       1.422562756424567       1.120536930268883       1.171270520369087       1.649178092061399       2.170830098964518
      0.2288994500717702       1.506916161420014       2.794203749319201       3.585486777205559       3.688629567301755       3.340441839258928        2.93444760730479       2.662216251606178          2.433789115926
](:);

  
## Genere N datos para reconstruir el plano
p=[ 0.9433   0.1362
   -0.6484   0.8266
   -0.1657  -0.4825
   -0.9267   0.7645
    0.8303   0.7195
   -0.1582  -0.5966
   -0.9567  -0.8274
    0.1827   0.5699
   -0.6551   0.5830
    0.4405   0.5132];

z=[ 2.6173
    0.8475
    2.9215
   -0.8001
    1.7872
    2.8932
    2.1315
    0.3128
   -0.1577
    0.2549 ];

rz=[];

## Use la función bajo prueba (DUT) para estimar los valores y parámetros
rz=lowess(p,X_gt,z_gt,0.03);
  
eps=0.4;
errz = norm(rz-z);
if (errz > eps)
  printf("falló con error en z de norma %f\n",errz);
else
  printf("ok ");
endif

printf("\n");



printf("Prueba regresión ponderada localmente in 1D: ")


## Genere N datos para estimar los parámetros
N=10;
X_gt=[ 0.640165
      -0.208884
      -0.507607
      -0.866588
       0.247466
       0.390094
       0.952271
      -0.902457
       0.876131
      -0.857361 ];

z_gt=[
  -0.017222
   0.721974
   1.084906
   1.591880
   0.270906
   0.155558
  -0.180225
   1.646786
  -0.145849
   1.577881
];
  
## Genere N datos para reconstruir el plano
p=[ 0.9433
   -0.6484
   -0.1657
   -0.9267
    0.8303
   -0.1582
   -0.9567
    0.1827
   -0.6551
    0.4405];

z = [
  -0.1764
   1.2745
   0.6739
   1.6843
  -0.1235
   0.6657
   1.7313
   0.3273
   1.2838
   0.1177
];

rz=[];

## Use la función bajo prueba (DUT) para estimar los valores y parámetros
rz=lowess(p,X_gt,z_gt,0.05);

eps=0.05;
errz = norm(rz-z);
if (errz > eps)
  printf("falló con error en z de norma %f\n",errz);
else
  printf("ok ");
endif

printf("\n");

font_size_letters = 32;
font_size_numbers = 24;
figure("name","Predicciones de regresión ponderada localmente");
hold off;
plot(X_gt(:,1),z_gt,"o;Ground truth;","color",[0.5,0,0]);
hold on;
plot(p(:,1),z,"x;Baseline;","color",[0,0.5,0]);
plot(p(:,1),rz,"s;Prediction;","color",[0,0,0.5]);
set(gca, 'FontSize', font_size_numbers); 
